<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html"><link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html"><link rel="import" href="../bower_components/polymer/lib/mixins/gesture-event-listeners.html"><link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html"><link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html"><link rel="import" href="../bower_components/app-layout/app-header/app-header.html"><link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html"><link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html"><link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/iron-icons/communication-icons.html"><link rel="import" href="../bower_components/iron-image/iron-image.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/paper-item/paper-item.html"><link rel="import" href="../bower_components/paper-listbox/paper-listbox.html"><link rel="import" href="../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../bower_components/polymerfire/firebase-query.html"><link rel="import" href="elements/case-preview-card.html"><link rel="import" href="my-icons.html"><link rel="import" href="style/shared-styles.html"></head><body><dom-module id="my-home"><template><style include="shared-styles"></style><firebase-auth id="FBAuth" user="{{user}}"></firebase-auth><firebase-query id="FBQuery" path="/cases" data="{{userCases}}"></firebase-query><firebase-query id="FBSave" path="/users/[[user.uid]]/cases" data="{{casesDone}}"></firebase-query><app-drawer-layout fullbleed=""><app-drawer slot="drawer"><div style="height:100% ; overflow-x:hidden ; overflow-y:auto;"><div class="welcome"></div><div style="width:100%"><paper-listbox selected="{{filter}}" attr-for-selected="label" selectable=".label"><paper-item label="all" class="label">All cases ([[allCases.length]])</paper-item><div class="separator"></div><template is="dom-repeat" items="{{tags}}" as="tag"><paper-item label$="[[tag.value]]" class="label">[[tag.value]] ([[tag.count]])</paper-item></template></paper-listbox></div></div></app-drawer><app-header-layout has-scrolling-region=""><app-header slot="header" condenses="" reveals="" effects="waterfall"><app-toolbar><paper-icon-button icon="my-icons:menu" drawer-toggle=""></paper-icon-button><div main-title="">Web Medical Tools</div><div class="emailTest"><div>{{user.email}}</div><paper-icon-button icon="icons:exit-to-app" on-tap="_handleLogout"></paper-icon-button></div></app-toolbar></app-header><div class="container"><template is="dom-repeat" items="{{allCases}}" as="mycase" filter="{{_filterCases(filter)}}"><case-preview-card case-preview="[[mycase]]"></case-preview-card></template></div></app-header-layout></app-drawer-layout></template><script>var MyHome=function(_Polymer$GestureEvent){babelHelpers.inherits(MyHome,_Polymer$GestureEvent);function MyHome(){babelHelpers.classCallCheck(this,MyHome);return babelHelpers.possibleConstructorReturn(this,(MyHome.__proto__||Object.getPrototypeOf(MyHome)).apply(this,arguments))}babelHelpers.createClass(MyHome,[{key:"_routePageChanged",value:function _routePageChanged(routeData){console.log("Path changed!");if(routeData===void 0){}}},{key:"_userChanged",value:function _userChanged(user){console.log("my-home _userChanged : ",user)}},{key:"_userCasesChanged",value:function _userCasesChanged(userCases){if(userCases===void 0){return}var tagSet={},object=userCases.indexSplices[0].object,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=object[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var singlecase=_step.value,tagList=singlecase.tags,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=tagList[Symbol.iterator](),_step2,tag;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){tag=_step2.value;if(tagSet[tag]){tagSet[tag]+=1}else{tagSet[tag]=1}}}catch(err){_didIteratorError2=!0;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&null!=_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}var tagArray=[];for(var value in tagSet){tagArray.push({value:value,count:tagSet[value]})}this.set("tags",tagArray);this.allCases=[];this.set("allCases",userCases.indexSplices[0].object)}},{key:"_casesDoneChanged",value:function _casesDoneChanged(casesDone){if(casesDone===void 0){return}for(var index=casesDone.indexSplices[0].index,object=casesDone.indexSplices[0].object,newCase=object[index],i=0;i<this.allCases.length;i++){if(newCase.id===this.allCases[i].id){this.set(["allCases",i,"completed"],!0);this.allCases=this.allCases.slice()}}}},{key:"_handleLogout",value:function _handleLogout(){this.$.FBAuth.signOut()}},{key:"_fillStar",value:function _fillStar(starIndex,difficulty){return starIndex<=difficulty?"star":"star grey"}},{key:"_filterCases",value:function _filterCases(filter){if("all"===filter){return function(){return!0}}else if("completed"===filter){return function(mycase){return mycase.completed}}else if("todo"===filter){return function(mycase){return!mycase.completed}}else{return function(mycase){return-1!=mycase.tags.indexOf(filter)}}}},{key:"_computeCompleted",value:function _computeCompleted(cases){var completed=cases.filter(function(acase){return acase.completed});return completed.length}},{key:"_computeTodo",value:function _computeTodo(cases){var todo=cases.filter(function(acase){return!acase.completed});return todo.length}},{key:"_computeTodoList",value:function _computeTodoList(cases){var todo=cases.filter(function(acase){return!acase.completed});return todo}}],[{key:"is",get:function get(){return"my-home"}},{key:"properties",get:function get(){return{page:{type:String,reflectToAttribute:!0},tags:{type:Array,value:[]},user:{type:Object,value:{},observer:"_userChanged"},userCases:{type:Array,value:[]},allCases:{type:Array,value:[]},completed:{type:Number,computed:"_computeCompleted(allCases)"},todo:{type:Number,computed:"_computeTodo(allCases)",notify:!0},todoList:{type:Array,computed:"_computeTodoList(allCases)",notify:!0},casesDone:{type:Array},filter:{type:String,value:"all"}}}},{key:"observers",get:function get(){return["_userCasesChanged(userCases.splices)","_casesDoneChanged(casesDone.splices)"]}}]);return MyHome}(Polymer.GestureEventListeners(Polymer.Element));window.customElements.define(MyHome.is,MyHome);</script></dom-module></body></html>