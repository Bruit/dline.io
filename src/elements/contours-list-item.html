<link rel="import " href="../my-icons.html ">
<link rel="import " href="../style/shared-styles.html ">

<div hidden="" by-polymer-bundler=""><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script>(function () {
  'use strict';
  /**
  Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to
  implement a Material Design dialog.
   For example, if `<paper-dialog-impl>` implements this behavior:
       <paper-dialog-impl>
          <h2>Header</h2>
          <div>Dialog body</div>
          <div class="buttons">
              <paper-button dialog-dismiss>Cancel</paper-button>
              <paper-button dialog-confirm>Accept</paper-button>
          </div>
      </paper-dialog-impl>
   `paper-dialog-shared-styles.html` provide styles for a header, content area, and
  an action area for buttons. Use the `<h2>` tag for the header and the `buttons`
  class for the action area. You can use the `paper-dialog-scrollable` element (in
  its own repository) if you need a scrolling content area.
   Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive controls
  to close the dialog. If the user dismisses the dialog with `dialog-confirm`, the
  `closingReason` will update to include `confirmed: true`.
   ### Accessibility
   This element has `role="dialog"` by default. Depending on the context, it may be
  more appropriate to override this attribute with `role="alertdialog"`.
   If `modal` is set, the element will prevent the focus from exiting the element.
  It will also ensure that focus remains in the dialog.
   @hero hero.svg
  @demo demo/index.html
  @polymerBehavior Polymer.PaperDialogBehavior
  */

  Polymer.PaperDialogBehaviorImpl = {
    hostAttributes: {
      'role': 'dialog',
      'tabindex': '-1'
    },
    properties: {
      /**
       * If `modal` is true, this implies `no-cancel-on-outside-click`,
       * `no-cancel-on-esc-key` and `with-backdrop`.
       */
      modal: {
        type: Boolean,
        value: false
      },
      __readied: {
        type: Boolean,
        value: false
      }
    },
    observers: ['_modalChanged(modal, __readied)'],
    listeners: {
      'tap': '_onDialogClick'
    },

    /**
     * @return {void}
     */
    ready: function () {
      // Only now these properties can be read.
      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
      this.__prevWithBackdrop = this.withBackdrop;
      this.__readied = true;
    },
    _modalChanged: function (modal, readied) {
      // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.
      // We need to wait for the element to be ready before we can read the
      // properties values.
      if (!readied) {
        return;
      }

      if (modal) {
        this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
        this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
        this.__prevWithBackdrop = this.withBackdrop;
        this.noCancelOnOutsideClick = true;
        this.noCancelOnEscKey = true;
        this.withBackdrop = true;
      } else {
        // If the value was changed to false, let it false.
        this.noCancelOnOutsideClick = this.noCancelOnOutsideClick && this.__prevNoCancelOnOutsideClick;
        this.noCancelOnEscKey = this.noCancelOnEscKey && this.__prevNoCancelOnEscKey;
        this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;
      }
    },
    _updateClosingReasonConfirmed: function (confirmed) {
      this.closingReason = this.closingReason || {};
      this.closingReason.confirmed = confirmed;
    },

    /**
     * Will dismiss the dialog if user clicked on an element with dialog-dismiss
     * or dialog-confirm attribute.
     */
    _onDialogClick: function (event) {
      // Search for the element with dialog-confirm or dialog-dismiss,
      // from the root target until this (excluded).
      var path = Polymer.dom(event).path;

      for (var i = 0, l = path.indexOf(this); i < l; i++) {
        var target = path[i];

        if (target.hasAttribute && (target.hasAttribute('dialog-dismiss') || target.hasAttribute('dialog-confirm'))) {
          this._updateClosingReasonConfirmed(target.hasAttribute('dialog-confirm'));

          this.close();
          event.stopPropagation();
          break;
        }
      }
    }
  };
  /** @polymerBehavior */

  Polymer.PaperDialogBehavior = [Polymer.IronOverlayBehavior, Polymer.PaperDialogBehaviorImpl];
})();</script>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!--
### Styling

The following custom properties and mixins are available for styling.

Custom property | Description | Default
----------------|-------------|----------
`--paper-dialog-background-color` | Dialog background color                     | `--primary-background-color`
`--paper-dialog-color`            | Dialog foreground color                     | `--primary-text-color`
`--paper-dialog`                  | Mixin applied to the dialog                 | `{}`
`--paper-dialog-title`            | Mixin applied to the title (`<h2>`) element | `{}`
`--paper-dialog-button-color`     | Button area foreground color                | `--default-primary-color`
-->

<dom-module id="paper-dialog-shared-styles" assetpath="../../bower_components/paper-dialog-behavior/">
  <template>
    <style>
      :host {
        display: block;
        margin: 24px 40px;

        background: var(--paper-dialog-background-color, var(--primary-background-color));
        color: var(--paper-dialog-color, var(--primary-text-color));

        @apply --paper-font-body1;
        @apply --shadow-elevation-16dp;
        @apply --paper-dialog;
      }

      :host > ::slotted(*) {
        margin-top: 20px;
        padding: 0 24px;
      }

      :host > ::slotted(.no-padding) {
        padding: 0;
      }

      
      :host > ::slotted(*:first-child) {
        margin-top: 24px;
      }

      :host > ::slotted(*:last-child) {
        margin-bottom: 24px;
      }

      /* In 1.x, this selector was `:host > ::content h2`. In 2.x <slot> allows
      to select direct children only, which increases the weight of this
      selector, so we have to re-define first-child/last-child margins below. */
      :host > ::slotted(h2) {
        position: relative;
        margin: 0;

        @apply --paper-font-title;
        @apply --paper-dialog-title;
      }

      /* Apply mixin again, in case it sets margin-top. */
      :host > ::slotted(h2:first-child) {
        margin-top: 24px;
        @apply --paper-dialog-title;
      }

      /* Apply mixin again, in case it sets margin-bottom. */
      :host > ::slotted(h2:last-child) {
        margin-bottom: 24px;
        @apply --paper-dialog-title;
      }

      :host > ::slotted(.paper-dialog-buttons),
      :host > ::slotted(.buttons) {
        position: relative;
        padding: 8px 8px 8px 24px;
        margin: 0;

        color: var(--paper-dialog-button-color, var(--primary-color));

        @apply --layout-horizontal;
        @apply --layout-end-justified;
      }
    </style>
  </template>
</dom-module>
<!--
Material design: [Dialogs](https://www.google.com/design/spec/components/dialogs.html)

`<paper-dialog>` is a dialog with Material Design styling and optional animations when it is
opened or closed. It provides styles for a header, content area, and an action area for buttons.
You can use the `<paper-dialog-scrollable>` element (in its own repository) if you need a scrolling
content area. To autofocus a specific child element after opening the dialog, give it the `autofocus`
attribute. See `Polymer.PaperDialogBehavior` and `Polymer.IronOverlayBehavior` for specifics.

For example, the following code implements a dialog with a header, scrolling content area and
buttons. Focus will be given to the `dialog-confirm` button when the dialog is opened.

    <paper-dialog>
      <h2>Header</h2>
      <paper-dialog-scrollable>
        Lorem ipsum...
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>
      </div>
    </paper-dialog>

### Styling

See the docs for `Polymer.PaperDialogBehavior` for the custom properties available for styling
this element.

### Animations

Set the `entry-animation` and/or `exit-animation` attributes to add an animation when the dialog
is opened or closed. See the documentation in
[PolymerElements/neon-animation](https://github.com/PolymerElements/neon-animation) for more info.

For example:

    <link rel="import" href="components/neon-animation/animations/scale-up-animation.html">
    <link rel="import" href="components/neon-animation/animations/fade-out-animation.html">

    <paper-dialog entry-animation="scale-up-animation"
                  exit-animation="fade-out-animation">
      <h2>Header</h2>
      <div>Dialog body</div>
    </paper-dialog>

### Accessibility

See the docs for `Polymer.PaperDialogBehavior` for accessibility features implemented by this
element.

@group Paper Elements
@element paper-dialog
@hero hero.svg
@demo demo/index.html
-->

<dom-module id="paper-dialog" assetpath="../../bower_components/paper-dialog/">
  <template>
    <style include="paper-dialog-shared-styles"></style>
    <slot></slot>
  </template>
</dom-module>

<script>Polymer({
  is: 'paper-dialog',
  behaviors: [Polymer.PaperDialogBehavior, Polymer.NeonAnimationRunnerBehavior],
  listeners: {
    'neon-animation-finish': '_onNeonAnimationFinish'
  },
  _renderOpened: function () {
    this.cancelAnimation();
    this.playAnimation('entry');
  },
  _renderClosed: function () {
    this.cancelAnimation();
    this.playAnimation('exit');
  },
  _onNeonAnimationFinish: function () {
    if (this.opened) {
      this._finishRenderOpened();
    } else {
      this._finishRenderClosed();
    }
  }
});</script>
</div><dom-module id="contours-list-item">

    <template>
        
        <style include="shared-styles">

        .contour-item, .contour-item-all {
            @apply --layout-horizontal;
        }

        .contour-item paper-checkbox, 
        .contour-item-all paper-checkbox {
            padding: 8px;
            margin-right: auto;
        }

        .contour-item iron-icon {
            padding: 8px;
            cursor: pointer;
            color: #767676;
        }

        paper-dialog.modal-contour {
            width: 350px;
        }
        paper-dialog.modal-contour > h2 {
            padding: 5px 30px;
        }
        paper-dialog.modal-contour > p {
            padding: 5px 30px;
            margin: 0;
        }

        </style>

        <div style="width:100%">
            
            <div class="separator"><span>[[title]]<span></span></span></div>

            <div class="contour-item-all">
                <paper-checkbox class="label" checked="{{allShow}}">
                    Show / hide all
                </paper-checkbox>
            </div>

            <div class="separator"></div>

            <template is="dom-repeat" items="{{contours}}" as="contour">

            <div class="contour-item" id="contour-{{contour.id}}" on-mouseover="_mouseOverContour" on-mouseout="_mouseOutContour">
                
                <paper-checkbox checked="{{contour.visible}}" on-tap="_onCheckContour">
                    <span style="color:{{contour.color}}">{{contour.label}}</span>
                </paper-checkbox>
                <template is="dom-if" if="{{contour.description}}">
                <iron-icon class="info" icon="icons:info" on-tap="_onContourInfo"></iron-icon>               
                </template>
            </div>

            </template>

    </div>

    <paper-dialog id="modalContourInfo" class="modal-contour">
        <h2 id="mciTitle"></h2>
        <p id="mciDescription"></p>
        <div class="buttons">
            <paper-button dialog-confirm="" autofocus="">Close</paper-button>
        </div>
    </paper-dialog>

    </template>

    <script>class ContoursListIem extends Polymer.Element {
  static get is() {
    return 'contours-list-item';
  }

  static get properties() {
    return {
      title: {
        type: String,
        value: "List of contours"
      },
      contours: {
        type: Array,
        value: []
      },
      allShow: {
        type: Boolean,
        value: true,
        observer: '_allShowChanged'
      }
    };
  }

  constructor() {
    super();
    this.stopPropagationAllShow = false;
  }

  ready() {
    super.ready();
  }

  _allShowChanged() {
    if (this.stopPropagationAllShow) return;

    for (let i = 0; i < this.contours.length; i++) {
      this.set('contours.' + i + '.visible', this.allShow);

      this._updateContourVisibled(i);
    }
  }

  _mouseOverContour(e) {
    var id = this._getContourId(e.target);

    this.set('contours.' + id + '.contour.selected', true);
  }

  _mouseOutContour(e) {
    var id = this._getContourId(e.target);

    this.set('contours.' + id + '.contour.selected', false);
  }

  _onContourInfo(e) {
    var id = this._getContourId(e.target);

    if (id === null) return;
    this.$.mciTitle.innerHTML = this._unescapeText(this.contours[id].label);
    this.$.mciDescription.innerHTML = this._unescapeText(this.contours[id].description);
    this.$.modalContourInfo.open();
  }

  _unescapeText(text) {
    let elem = document.createElement('textarea');
    elem.innerHTML = text;
    return elem.textContent;
  }

  _onCheckContour(e) {
    var id = this._getContourId(e.target);

    this._updateContourVisibled(id);

    if (this.stopPropagationAllShow) return;

    this._updateAllShow();
  }

  _updateAllShow() {
    let flag = true;

    for (let i = 0; i < this.contours.length && flag; i++) {
      flag = flag && this.contours[i].visible;
    }

    this.stopPropagationAllShow = true;
    this.set('allShow', flag);
    this.stopPropagationAllShow = false;
  }

  _updateContourVisibled(id) {
    let visibled = this.contours[id].visible;
    this.set('contours.' + id + '.contour.meshBack.visible', visibled);
    this.set('contours.' + id + '.contour.meshFront.visible', visibled);
  }

  _getContourId(element) {
    let el = element;

    while ((el = el.parentElement) && !el.classList.contains('contour-item'));

    if (el == null) return;
    let id = el.getAttribute('id');
    id = id.replace('contour-', '');
    return parseInt(id);
  }

}

window.customElements.define(ContoursListIem.is, ContoursListIem);</script>

</dom-module>